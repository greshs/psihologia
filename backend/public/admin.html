<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∫—É—Ä—Å–∞ –ú–ê–ö</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e2d;
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border-left: 4px solid #8ba58f;
        }
        
        .section h2 {
            color: #2c3e2d;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a4a4a;
            font-weight: 600;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .array-item {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .btn {
            background: #8ba58f;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #6d8a71;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        .status {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.show {
            display: block;
        }
        
        .actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 20px;
            border-top: 2px solid #e0e0e0;
            margin-top: 40px;
            text-align: center;
        }
        
        .image-upload-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }
        
        .image-upload-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed #ddd;
            text-align: center;
        }
        
        .image-upload-item.has-image {
            border-color: #8ba58f;
            border-style: solid;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .image-upload-single {
            margin-top: 10px;
        }
        
        .image-preview-container {
            margin-bottom: 10px;
        }
        
        input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        
        .remove-image-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .remove-image-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∫—É—Ä—Å–∞ –ú–ê–ö</h1>
        
        <div id="status" class="status"></div>
        
        <form id="contentForm">
            <!-- Cover Section -->
            <div class="section">
                <h2>–û–±–ª–æ–∂–∫–∞ (Cover Block)</h2>
                <div class="form-group">
                    <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="cover_subtitle" name="cover.subtitle">
                </div>
                <div class="form-group">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ \n –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏)</label>
                    <textarea id="cover_title" name="cover.title"></textarea>
                </div>
                <div class="form-group">
                    <label>–°—Ä–æ–∫–∏</label>
                    <input type="text" id="cover_dates" name="cover.dates">
                </div>
                <div class="form-group">
                    <label>–í—Ä–µ–º—è</label>
                    <input type="text" id="cover_time" name="cover.time">
                </div>
                <div class="form-group">
                    <label>–§–æ—Ä–º–∞—Ç</label>
                    <input type="text" id="cover_format" name="cover.format">
                </div>
                <div class="form-group">
                    <label>–¶–µ–Ω–∞ –ø–æ–ª–Ω–æ–≥–æ –∫—É—Ä—Å–∞</label>
                    <input type="text" id="cover_priceFull" name="cover.priceFull">
                </div>
                <div class="form-group">
                    <label>–¶–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è</label>
                    <input type="text" id="cover_priceSingle" name="cover.priceSingle">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="cover_description" name="cover.description"></textarea>
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–ø–∏—Å–∏</label>
                    <input type="text" id="cover_registerButton" name="cover.registerButton">
                </div>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏</label>
                    <input type="url" id="cover_registrationLink" name="cover.registrationLink">
                </div>
            </div>
            
            <!-- Program Section -->
            <div class="section">
                <h2>–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</h2>
                <div class="form-group">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="program_title" name="program.title">
                </div>
                <div id="program_items">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <button type="button" class="btn btn-small" onclick="addProgramItem()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
            </div>
            
            <!-- Results Section -->
            <div class="section">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è</h2>
                <div class="form-group">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="results_title" name="results.title">
                </div>
                <div id="results_items">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <button type="button" class="btn btn-small" onclick="addResultItem()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
            </div>
            
            <!-- Banner Section -->
            <div class="section">
                <h2>–ë–∞–Ω–Ω–µ—Ä</h2>
                <div class="form-group">
                    <label>–¢–µ–∫—Å—Ç –±–∞–Ω–Ω–µ—Ä–∞</label>
                    <input type="text" id="banner_text" name="banner.text">
                </div>
            </div>
            
            <!-- Director Section -->
            <div class="section">
                <h2>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
                <div class="form-group">
                    <label>–ú–µ—Ç–∫–∞</label>
                    <input type="text" id="director_label" name="director.label">
                </div>
                <div class="form-group">
                    <label>–ò–º—è</label>
                    <input type="text" id="director_name" name="director.name">
                </div>
                <div class="form-group">
                    <label>–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è</label>
                    <textarea id="director_credentials" name="director.credentials"></textarea>
                </div>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞</label>
                    <input type="url" id="director_link" name="director.link">
                </div>
            </div>
            
            <!-- Contact Section -->
            <div class="section">
                <h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
                <div class="form-group">
                    <label>–ú–µ—Ç–∫–∞</label>
                    <input type="text" id="contact_label" name="contact.label">
                </div>
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="text" id="contact_phone" name="contact.phone">
                </div>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏</label>
                    <input type="url" id="contact_registrationLink" name="contact.registrationLink">
                </div>
            </div>
            
            <!-- Images Section - Block 1 (Cover) -->
            <div class="section">
                <h2>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –ë–ª–æ–∫ 1 (–û–±–ª–æ–∂–∫–∞)</h2>
                
                <div class="form-group">
                    <label>–ö–∞—Ä—É—Å–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</label>
                    <div id="carousel_images" class="image-upload-container">
                        <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    <button type="button" class="btn btn-small" onclick="addCarouselImageSlot()" style="margin-top: 10px;">+ –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                    <p style="margin-top: 10px; color: #666; font-size: 12px;">üí° –í—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å" –ø–æ–¥ –Ω–∏–º. –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
                </div>
                
                <div class="form-group">
                    <label>QR –∫–æ–¥ –¥–ª—è –∑–∞–ø–∏—Å–∏ (–ë–ª–æ–∫ 1)</label>
                    <div class="image-upload-single">
                        <div class="image-preview-container" id="cover_qr_preview">
                            <img id="cover_qr_preview_img" src="" alt="QR –∫–æ–¥" style="display: none; max-width: 200px; max-height: 200px; border-radius: 8px; margin-bottom: 10px;">
                        </div>
                        <input type="file" id="cover_qr_upload" accept="image/*" onchange="uploadImage('cover_qr', 'cover.qrCode', this)">
                        <input type="hidden" id="cover_qr_url" name="cover.qrCode">
                    </div>
                </div>
            </div>
            
            <!-- Images Section - Block 2 (Details) -->
            <div class="section">
                <h2>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –ë–ª–æ–∫ 2 (–î–µ—Ç–∞–ª–∏)</h2>
                
                <div class="form-group">
                    <label>–§–æ—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã</label>
                    <div class="image-upload-single">
                        <div class="image-preview-container" id="director_photo_preview">
                            <img id="director_photo_preview_img" src="" alt="–§–æ—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞" style="display: none; max-width: 300px; max-height: 300px; border-radius: 8px; margin-bottom: 10px;">
                        </div>
                        <input type="file" id="director_photo_upload" accept="image/*" onchange="uploadImage('director_photo', 'director.photo', this)">
                        <input type="hidden" id="director_photo_url" name="director.photo">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>QR –∫–æ–¥ –¥–ª—è –∑–∞–ø–∏—Å–∏ (–ë–ª–æ–∫ 2)</label>
                    <div class="image-upload-single">
                        <div class="image-preview-container" id="contact_qr_preview">
                            <img id="contact_qr_preview_img" src="" alt="QR –∫–æ–¥" style="display: none; max-width: 200px; max-height: 200px; border-radius: 8px; margin-bottom: 10px;">
                        </div>
                        <input type="file" id="contact_qr_upload" accept="image/*" onchange="uploadImage('contact_qr', 'contact.qrCode', this)">
                        <input type="hidden" id="contact_qr_url" name="contact.qrCode">
                    </div>
                </div>
            </div>
            
            <div class="actions">
                <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </form>
    </div>
    
    <script>
        const API_URL = window.location.origin + '/api/content';
        let programItemsCount = 0;
        let resultsItemsCount = 0;
        let carouselImagesCount = 0;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadContent() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                populateForm(data);
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
            }
        }
        
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã–º–∏
        function populateForm(data) {
            // Cover
            document.getElementById('cover_subtitle').value = data.cover?.subtitle || '';
            document.getElementById('cover_title').value = data.cover?.title || '';
            document.getElementById('cover_dates').value = data.cover?.dates || '';
            document.getElementById('cover_time').value = data.cover?.time || '';
            document.getElementById('cover_format').value = data.cover?.format || '';
            document.getElementById('cover_priceFull').value = data.cover?.priceFull || '';
            document.getElementById('cover_priceSingle').value = data.cover?.priceSingle || '';
            document.getElementById('cover_description').value = data.cover?.description || '';
            document.getElementById('cover_registerButton').value = data.cover?.registerButton || '';
            document.getElementById('cover_registrationLink').value = data.cover?.registrationLink || '';
            
            // Program
            document.getElementById('program_title').value = data.program?.title || '';
            const programContainer = document.getElementById('program_items');
            programContainer.innerHTML = '';
            if (data.program?.items) {
                data.program.items.forEach((item, index) => {
                    addProgramItem(item, index);
                });
            }
            
            // Results
            document.getElementById('results_title').value = data.results?.title || '';
            const resultsContainer = document.getElementById('results_items');
            resultsContainer.innerHTML = '';
            if (data.results?.items) {
                data.results.items.forEach((item, index) => {
                    addResultItem(item, index);
                });
            }
            
            // Banner
            document.getElementById('banner_text').value = data.banner?.text || '';
            
            // Director
            document.getElementById('director_label').value = data.director?.label || '';
            document.getElementById('director_name').value = data.director?.name || '';
            document.getElementById('director_credentials').value = data.director?.credentials || '';
            document.getElementById('director_link').value = data.director?.link || '';
            
            // Contact
            document.getElementById('contact_label').value = data.contact?.label || '';
            document.getElementById('contact_phone').value = data.contact?.phone || '';
            document.getElementById('contact_registrationLink').value = data.contact?.registrationLink || '';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª–∏
            const carouselContainer = document.getElementById('carousel_images');
            carouselContainer.innerHTML = '';
            carouselImagesCount = 0;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ API
            const carouselImages = data.cover?.carouselImages || [];
            
            // –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            carouselImages.forEach(url => {
                if (url) {
                    addCarouselImageSlot(url);
                }
            });
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ –∏—Ö –º–µ–Ω—å—à–µ 4, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –¥–æ 4 —à—Ç—É–∫
            // –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –≤—Å–µ 4 –º–µ—Å—Ç–∞ –¥–ª—è —Ñ–æ—Ç–æ, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ
            const targetSlots = 4;
            const currentSlots = carouselImages.length;
            for (let i = currentSlots; i < targetSlots; i++) {
                addCarouselImageSlot('');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º QR –∫–æ–¥ –¥–ª—è –±–ª–æ–∫–∞ 1
            if (data.cover?.qrCode) {
                const coverQrPreview = document.getElementById('cover_qr_preview_img');
                const coverQrUrl = document.getElementById('cover_qr_url');
                if (coverQrPreview && coverQrUrl) {
                    coverQrPreview.src = window.location.origin + data.cover.qrCode;
                    coverQrPreview.style.display = 'block';
                    coverQrUrl.value = data.cover.qrCode;
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞
            if (data.director?.photo) {
                const directorPhotoPreview = document.getElementById('director_photo_preview_img');
                const directorPhotoUrl = document.getElementById('director_photo_url');
                if (directorPhotoPreview && directorPhotoUrl) {
                    directorPhotoPreview.src = window.location.origin + data.director.photo;
                    directorPhotoPreview.style.display = 'block';
                    directorPhotoUrl.value = data.director.photo;
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º QR –∫–æ–¥ –¥–ª—è –±–ª–æ–∫–∞ 2
            if (data.contact?.qrCode) {
                const contactQrPreview = document.getElementById('contact_qr_preview_img');
                const contactQrUrl = document.getElementById('contact_qr_url');
                if (contactQrPreview && contactQrUrl) {
                    contactQrPreview.src = window.location.origin + data.contact.qrCode;
                    contactQrPreview.style.display = 'block';
                    contactQrUrl.value = data.contact.qrCode;
                }
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
        function addProgramItem(value = '', index = null) {
            const container = document.getElementById('program_items');
            const itemIndex = index !== null ? index : programItemsCount++;
            const div = document.createElement('div');
            div.className = 'array-item';
            div.innerHTML = `
                <label>–ü—É–Ω–∫—Ç ${itemIndex + 1}</label>
                <textarea name="program.items[${itemIndex}]" class="program-item">${value}</textarea>
                <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.remove()" style="margin-top: 10px;">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            container.appendChild(div);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function addResultItem(value = '', index = null) {
            const container = document.getElementById('results_items');
            const itemIndex = index !== null ? index : resultsItemsCount++;
            const div = document.createElement('div');
            div.className = 'array-item';
            div.innerHTML = `
                <label>–ü—É–Ω–∫—Ç ${itemIndex + 1}</label>
                <textarea name="results.items[${itemIndex}]" class="result-item">${value}</textarea>
                <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.remove()" style="margin-top: 10px;">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            container.appendChild(div);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type} show`;
            setTimeout(() => {
                status.classList.remove('show');
            }, 5000);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        async function uploadImage(imageId, dataPath, fileInput) {
            const file = fileInput.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.success) {
                    const fullUrl = window.location.origin + result.url;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å URL
                    const urlInput = document.getElementById(imageId + '_url');
                    if (urlInput) {
                        urlInput.value = result.url;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                    const previewImg = document.getElementById(imageId + '_preview_img');
                    if (previewImg) {
                        previewImg.src = fullUrl;
                        previewImg.style.display = 'block';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º content.json —Å—Ä–∞–∑—É
                    await updateImageInContent(dataPath, result.url);
                    
                    showStatus('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ', 'success');
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ content.json
        async function updateImageInContent(path, url) {
            try {
                const response = await fetch(API_URL);
                const currentContent = await response.json();
                
                // –†–∞–∑–±–∏–≤–∞–µ–º –ø—É—Ç—å —Ç–∏–ø–∞ "cover.qrCode" –Ω–∞ —á–∞—Å—Ç–∏
                const pathParts = path.split('.');
                let obj = currentContent;
                for (let i = 0; i < pathParts.length - 1; i++) {
                    if (!obj[pathParts[i]]) {
                        obj[pathParts[i]] = {};
                    }
                    obj = obj[pathParts[i]];
                }
                obj[pathParts[pathParts.length - 1]] = url;
                
                const updateResponse = await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(currentContent)
                });
                
                if (!updateResponse.ok) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ:', error);
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—É—Å–µ–ª—å—é
        function addCarouselImageSlot(url = '') {
            const container = document.getElementById('carousel_images');
            const index = carouselImagesCount++;
            const div = document.createElement('div');
            div.className = 'image-upload-item' + (url ? ' has-image' : '');
            div.id = `carousel_image_${index}`;
            
            const fullUrl = url ? (window.location.origin + url) : '';
            
            div.innerHTML = `
                <div class="image-preview-container">
                    <img class="image-preview" id="carousel_preview_${index}" src="${fullUrl}" style="display: ${url ? 'block' : 'none'};" alt="–ü—Ä–µ–≤—å—é ${index + 1}">
                </div>
                <input type="file" id="carousel_upload_${index}" accept="image/*" onchange="uploadCarouselImage(${index}, this)">
                <input type="hidden" id="carousel_url_${index}" value="${url}">
                <button type="button" class="remove-image-btn" onclick="removeCarouselImage(${index})">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            
            container.appendChild(div);
        }
        
        async function uploadCarouselImage(index, fileInput) {
            const file = fileInput.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.success) {
                    const fullUrl = window.location.origin + result.url;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
                    const urlInput = document.getElementById(`carousel_url_${index}`);
                    urlInput.value = result.url;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                    const previewImg = document.getElementById(`carousel_preview_${index}`);
                    previewImg.src = fullUrl;
                    previewImg.style.display = 'block';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                    const container = document.getElementById(`carousel_image_${index}`);
                    container.classList.add('has-image');
                    
                    // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º content.json –∑–¥–µ—Å—å - —Å–æ—Ö—Ä–∞–Ω–∏–º –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
                    showStatus('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è" –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.', 'success');
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }
        
        function removeCarouselImage(index) {
            const container = document.getElementById(`carousel_image_${index}`);
            if (container) {
                // –û—á–∏—â–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å URL
                const urlInput = document.getElementById(`carousel_url_${index}`);
                if (urlInput) {
                    urlInput.value = '';
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                const previewImg = document.getElementById(`carousel_preview_${index}`);
                if (previewImg) {
                    previewImg.style.display = 'none';
                    previewImg.src = '';
                }
                
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å has-image
                container.classList.remove('has-image');
                
                // –û—á–∏—â–∞–µ–º input file
                const fileInput = document.getElementById(`carousel_upload_${index}`);
                if (fileInput) {
                    fileInput.value = '';
                }
                
                // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º content.json –∑–¥–µ—Å—å - —Å–æ—Ö—Ä–∞–Ω–∏–º –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
            }
        }
        
        // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã (–≤–∫–ª—é—á–∞—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
        document.getElementById('contentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                cover: {
                    subtitle: document.getElementById('cover_subtitle').value,
                    title: document.getElementById('cover_title').value,
                    dates: document.getElementById('cover_dates').value,
                    time: document.getElementById('cover_time').value,
                    format: document.getElementById('cover_format').value,
                    priceFull: document.getElementById('cover_priceFull').value,
                    priceSingle: document.getElementById('cover_priceSingle').value,
                    description: document.getElementById('cover_description').value,
                    registerButton: document.getElementById('cover_registerButton').value,
                    registrationLink: document.getElementById('cover_registrationLink').value,
                    qrCode: document.getElementById('cover_qr_url').value || undefined,
                    carouselImages: Array.from(document.querySelectorAll('[id^="carousel_url_"]')).map(el => el.value).filter(v => v && v.trim())
                },
                program: {
                    title: document.getElementById('program_title').value,
                    items: Array.from(document.querySelectorAll('.program-item')).map(el => el.value).filter(v => v.trim())
                },
                results: {
                    title: document.getElementById('results_title').value,
                    items: Array.from(document.querySelectorAll('.result-item')).map(el => el.value).filter(v => v.trim())
                },
                banner: {
                    text: document.getElementById('banner_text').value
                },
                director: {
                    label: document.getElementById('director_label').value,
                    name: document.getElementById('director_name').value,
                    credentials: document.getElementById('director_credentials').value,
                    link: document.getElementById('director_link').value,
                    photo: document.getElementById('director_photo_url').value || undefined
                },
                contact: {
                    label: document.getElementById('contact_label').value,
                    phone: document.getElementById('contact_phone').value,
                    registrationLink: document.getElementById('contact_registrationLink').value,
                    qrCode: document.getElementById('contact_qr_url').value || undefined
                }
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    showStatus('–ö–æ–Ω—Ç–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            }
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadContent();
    </script>
</body>
</html>

